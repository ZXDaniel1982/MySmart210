From 887ac1708faf2ea73bdd860a6624f9035920b544 Mon Sep 17 00:00:00 2001
From: dzhang <daniel.zhang@aviatnet.com>
Date: Mon, 11 Jan 2021 17:33:58 +1300
Subject: [PATCH] Compile success smdkc100 as smart210

---
 arch/arm/mach-s5pc1xx/Kconfig     |   2 +
 board/samsung/smdkc100/smdkc100.c |   9 ++++
 configs/smdkc100_defconfig        |   3 ++
 scripts/Makefile.spl              |   2 +-
 tools/Makefile                    |   3 ++
 tools/mksmart210                  | Bin 0 -> 8904 bytes
 tools/mksmart210.c                |  91 ++++++++++++++++++++++++++++++++++++++
 7 files changed, 109 insertions(+), 1 deletion(-)
 create mode 100755 tools/mksmart210
 create mode 100644 tools/mksmart210.c

diff --git a/arch/arm/mach-s5pc1xx/Kconfig b/arch/arm/mach-s5pc1xx/Kconfig
index 8cffced..652525d 100644
--- a/arch/arm/mach-s5pc1xx/Kconfig
+++ b/arch/arm/mach-s5pc1xx/Kconfig
@@ -12,6 +12,8 @@ config TARGET_S5P_GONI
 
 config TARGET_SMDKC100
 	bool "Support smdkc100 board"
+    select SUPPORT_SPL
+    select SPL
 	select OF_CONTROL
 
 endchoice
diff --git a/board/samsung/smdkc100/smdkc100.c b/board/samsung/smdkc100/smdkc100.c
index d034f53..c799cf5 100644
--- a/board/samsung/smdkc100/smdkc100.c
+++ b/board/samsung/smdkc100/smdkc100.c
@@ -16,6 +16,15 @@
 
 DECLARE_GLOBAL_DATA_PTR;
 
+#ifdef CONFIG_SPL_BUILD
+
+void board_init_f(ulong bootflag)
+{
+	
+}
+
+#endif
+
 /*
  * Miscellaneous platform dependent initialisations
  */
diff --git a/configs/smdkc100_defconfig b/configs/smdkc100_defconfig
index e12ac6a..093a4ba 100644
--- a/configs/smdkc100_defconfig
+++ b/configs/smdkc100_defconfig
@@ -28,3 +28,6 @@ CONFIG_ENV_ADDR=0x40000
 CONFIG_MTD=y
 CONFIG_SMC911X=y
 CONFIG_SMC911X_BASE=0x98800300
+CONFIG_SPL=y
+CONFIG_SUPPORT_SPL=y
+# CONFIG_SPL_FRAMEWORK is not set
diff --git a/scripts/Makefile.spl b/scripts/Makefile.spl
index 9f1f744..8af9d83 100644
--- a/scripts/Makefile.spl
+++ b/scripts/Makefile.spl
@@ -336,7 +336,7 @@ endif
 $(obj)/$(BOARD)-spl.bin: $(obj)/u-boot-spl.bin
 	$(if $(wildcard $(objtree)/spl/board/samsung/$(BOARD)/tools/mk$(BOARD)spl),\
 	$(objtree)/spl/board/samsung/$(BOARD)/tools/mk$(BOARD)spl,\
-	$(objtree)/tools/mkexynosspl) $(VAR_SIZE_PARAM) $< $@
+	$(objtree)/tools/mksmart210) $(VAR_SIZE_PARAM) $< $@
 endif
 
 quiet_cmd_objcopy = OBJCOPY $@
diff --git a/tools/Makefile b/tools/Makefile
index 253a6b9..0038788 100644
--- a/tools/Makefile
+++ b/tools/Makefile
@@ -179,6 +179,9 @@ hostprogs-$(CONFIG_EXYNOS5250) += mkexynosspl
 hostprogs-$(CONFIG_EXYNOS5420) += mkexynosspl
 HOSTCFLAGS_mkexynosspl.o := -pedantic
 
+hostprogs-$(CONFIG_S5PC100) += mksmart210
+HOSTCFLAGS_mksmart210.o := -pedantic
+
 ifdtool-objs := $(LIBFDT_OBJS) ifdtool.o
 hostprogs-$(CONFIG_X86) += ifdtool
 
diff --git a/tools/mksmart210 b/tools/mksmart210
new file mode 100755
index 0000000000000000000000000000000000000000..cbc6e1292ecb484da9ebd377d8fbaea3131f323d
GIT binary patch
literal 8904
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
RSGD%{ii@}BZO-lO{|o9A!E68k

literal 0
HcmV?d00001

diff --git a/tools/mksmart210.c b/tools/mksmart210.c
new file mode 100644
index 0000000..7783b4c
--- /dev/null
+++ b/tools/mksmart210.c
@@ -0,0 +1,91 @@
+#include <stdio.h>
+#include <string.h>
+#include <stdlib.h>
+
+#define IMG_SIZE        16 * 1024
+#define HEADER_SIZE     16
+
+int main (int argc, char *argv[])
+{
+        FILE                    *fp;
+        unsigned                char *buffer;
+        int                             bufferLen;
+        int                             nbytes, fileLen;
+        unsigned int    checksum, count;
+        int                             i;
+
+        if (argc != 3)
+        {
+                printf("Usage: %s <source file> <destination file>\n", argv[0]);
+                return -1;
+        }
+
+        /* 分配16KByte的buffer,BL1最大为16KByte,并初始化为0 */
+        buffer = calloc(1, IMG_SIZE);
+        if (!buffer)
+        {
+                perror("Alloc buffer failed!");
+                return -1;
+        }
+
+        /* 打开源bin文件 */
+        fp = fopen(argv[1], "rb");
+        if( fp == NULL)
+        {
+                perror("source file open error");
+                free(buffer);
+                return -1;
+        }
+        /* 获取源bin文件的长度 */
+        fseek(fp, 0L, SEEK_END);
+        fileLen = ftell(fp);
+        fseek(fp, 0L, SEEK_SET);
+
+        /* 源bin文件不得超过(16K-16)Byte */
+        if (fileLen > (IMG_SIZE - HEADER_SIZE))
+        {
+                fprintf(stderr, "Source file is too big(> 16KByte)\n");
+                free(buffer);
+                fclose(fp);
+        }
+
+        /* 计算校验和 */
+        i = 0;
+        checksum = 0;
+        while (fread(buffer + HEADER_SIZE + i, 1, 1, fp))
+        {
+                checksum += buffer[HEADER_SIZE + i++];
+        }
+        fclose(fp);
+
+
+        /* 计算BL1的大小(BL1的大小包括BL1的头信息),并保存到buffer[0~3]中 */
+        fileLen += HEADER_SIZE;
+        memcpy(buffer, &fileLen, 4);
+
+        // 将校验和保存在buffer[8~15]
+        memcpy(buffer + 8, &checksum, 4);
+
+        /* 打开目标文件 */
+        fp = fopen(argv[2], "wb");
+        if (fp == NULL)
+        {
+                perror("destination file open error");
+                free(buffer);
+                return -1;
+        }
+		// 将buffer拷贝到目标bin文件中
+        nbytes  = fwrite(buffer, 1, fileLen, fp);
+        if (nbytes != fileLen)
+        {
+                perror("destination file write error");
+                free(buffer);
+                fclose(fp);
+                return -1;
+        }
+
+        free(buffer);
+        fclose(fp);
+
+        return 0;
+}
-- 
2.7.4

