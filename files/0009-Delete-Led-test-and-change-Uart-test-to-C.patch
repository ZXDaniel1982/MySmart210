From a7b93fe619136174fd6c7cb95156e3a9b946cf71 Mon Sep 17 00:00:00 2001
From: dzhang <daniel.zhang@aviatnet.com>
Date: Mon, 18 Jan 2021 20:32:49 +1300
Subject: [PATCH] Delete Led test and change Uart test to C

---
 board/samsung/smdkc100/lowlevel_init.S | 120 +------------------------
 board/samsung/smdkc100/smdkc100.c      |  15 ++++
 2 files changed, 18 insertions(+), 117 deletions(-)

diff --git a/board/samsung/smdkc100/lowlevel_init.S b/board/samsung/smdkc100/lowlevel_init.S
index d451ad9830..8b764234ae 100644
--- a/board/samsung/smdkc100/lowlevel_init.S
+++ b/board/samsung/smdkc100/lowlevel_init.S
@@ -78,129 +78,15 @@ lowlevel_init:
 
 #else
 
-  /* led test with 2 light on */
-  bl led_test
-
-  /* uart test output "Hello wo" */
-  bl uart_test
-
-  /* led test with 1 light on */
-  bl led_test1
-  bl uart_test
+  /* uart test */
   bl uart_test
 
 #endif
-  mov lr, r9
-  mov pc, lr
-
-#ifndef CONFIG_SPL_BUILD
-
-/*
- * led_test: test led
- */
-led_test:
-#mov r7, lr
-
-  ldr r0,=0x30000000
-  ldr r1, =0x3
-  str r1, [r0]
-
-  ldr r2, [r0]
-
-  ldr r1, =0xe0200280
-  ldr r0, =0x00001111
-  str r0, [r1]
-
-  str r2, [r1, #0x4]
-
-# mov lr, r7
-  mov pc, lr
-
-led_test1:
-# mov r7, lr
-
-  ldr r0,=0x31000000
-  ldr r1, =0x7
-  str r1, [r0]
-
-  ldr r2, [r0]
-
-  ldr r1, =0xe0200280
-  ldr r0, =0x00001111
-  str r0, [r1]
-
-  str r2, [r1, #0x4]
-
-# mov lr, r7
-  mov pc, lr
-
-/*
- * uart_test : output "Hello wo"
- */
-uart_test:
-# mov r7, lr
 
-  ldr r8, =0xe2900000
-  ldr r1, ='H'
-  str r1, [r8, #0x20]
-
-  mov	r2, #0x100000
-1:	subs	r2, r2, #1
-	bne	1b
-
-  ldr r1, ='e'
-  str r1, [r8, #0x20]
-
-	mov	r2, #0x100000
-2:	subs	r2, r2, #1
-	bne	2b
-
-  ldr r1, ='l'
-  str r1, [r8, #0x20]
-
-	mov	r2, #0x100000
-3:	subs	r2, r2, #1
-	bne	3b
-
-  ldr r1, ='l'
-  str r1, [r8, #0x20]
-
-	mov	r2, #0x100000
-4:	subs	r2, r2, #1
-	bne	4b
-
-  ldr r1, ='o'
-  str r1, [r8, #0x20]
-
-	mov	r2, #0x100000
-5:	subs	r2, r2, #1
-	bne	5b
-
-  ldr r1, =' '
-  str r1, [r8, #0x20]
-
-	mov	r2, #0x100000
-6:	subs	r2, r2, #1
-	bne	6b
-
-  ldr r1, ='w'
-  str r1, [r8, #0x20]
-
-	mov	r2, #0x100000
-7:	subs	r2, r2, #1
-	bne	7b
-
-  ldr r1, ='o'
-  str r1, [r8, #0x20]
-
-	mov	r2, #0x100000
-8:	subs	r2, r2, #1
-	bne	8b
-
-# mov lr, r7
+  mov lr, r9
   mov pc, lr
 
-#else
+#ifdef CONFIG_SPL_BUILD
 
 /*
  * system_clock_init: Initialize core clock and bus clock.
diff --git a/board/samsung/smdkc100/smdkc100.c b/board/samsung/smdkc100/smdkc100.c
index 8d0f6aca72..8de346e729 100644
--- a/board/samsung/smdkc100/smdkc100.c
+++ b/board/samsung/smdkc100/smdkc100.c
@@ -50,6 +50,21 @@ void copy_bl2_to_ram(void)
         //CopySDMMCtoMem(0, 32 + bl2Size + kernelSize, rootfsSize, (u32 *)CONFIG_SYS_SDRAM_ROOTFS, 0);
     }
 }
+#else
+
+void uart_test(void)
+{
+#define UTRSTAT0 		( *((volatile unsigned long *)0xE2900010) )
+#define UTXH0 			( *((volatile unsigned long *)0xE2900020) )
+    char out[12] = "Hello world";
+    int i = 0;
+
+    for (i=0;i<11;i++) {
+	      while (!(UTRSTAT0 & (1<<2)));
+	      UTXH0 = out[i];                      	
+    }
+}
+
 #endif
 
 /*
-- 
2.30.0

