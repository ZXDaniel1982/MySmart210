From 536b616bf469970d368a90827530030d4bb4789c Mon Sep 17 00:00:00 2001
From: dzhang <daniel.zhang@aviatnet.com>
Date: Sat, 23 Jan 2021 15:41:12 +1300
Subject: [PATCH] System boot up success with legacy image

---
 board/samsung/smdkc100/smdkc100.c | 14 ++++++++------
 configs/smdkc100_defconfig        |  4 +++-
 2 files changed, 11 insertions(+), 7 deletions(-)

diff --git a/board/samsung/smdkc100/smdkc100.c b/board/samsung/smdkc100/smdkc100.c
index 8de346e729..d1e1a39655 100644
--- a/board/samsung/smdkc100/smdkc100.c
+++ b/board/samsung/smdkc100/smdkc100.c
@@ -38,16 +38,18 @@ void copy_bl2_to_ram(void)
         (((u8(*)(int, u32, unsigned short, u32*, u8))\
         (*((u32 *)0xD0037F98)))(ch, sb, bs, dst, i))
 
-    u32 bl2Size = 500 * 1024 / 512;       // 250K
-    //u32 kernelSize = 2 * 1024 * 1024 / 512;  // 2M
-    //u32 rootfsSize = 2 * 1024 * 1024 / 512;  // 2M
+    // u32 bl2Size = 500 * 1024 / 512;       // 500K   1000
+    // u32 kernelSize = 6 * 1024 * 1024 / 512;  // 6M  12288
+    // u32 rootfsSize = 2 * 1024 * 1024 / 512;  // 2M  4096
+    // u32 dtbSize = 1 * 1024 *1024 / 512;  // 1M      4096
 
     u32 V210_SDMMC_BASE = *(volatile u32 *)(0xD0037488);    // V210_SDMMC_BASE
 
     if (V210_SDMMC_BASE == 0xEB000000) {
-        CopySDMMCtoMem(0, 32, bl2Size, (u32 *)0x20000000, 0);
-        //CopySDMMCtoMem(0, 32 + bl2Size, kernelSize, (u32 *)CONFIG_SYS_SDRAM_KERNEL, 0);
-        //CopySDMMCtoMem(0, 32 + bl2Size + kernelSize, rootfsSize, (u32 *)CONFIG_SYS_SDRAM_ROOTFS, 0);
+        CopySDMMCtoMem(0, 32,    1000,  (u32 *)0x20000000, 0);  // u-boot.bin
+        CopySDMMCtoMem(0, 1032,  12288, (u32 *)0x23000000, 0);  // uImage
+        CopySDMMCtoMem(0, 13320, 4096,  (u32 *)0x23500000, 0);  // ramdisk.img
+        CopySDMMCtoMem(0, 17416, 2048,  (u32 *)0x33000000, 0);  // s5pv210-smdkv210.dtb
     }
 }
 #else
diff --git a/configs/smdkc100_defconfig b/configs/smdkc100_defconfig
index d5a39ef255..88f32222b1 100644
--- a/configs/smdkc100_defconfig
+++ b/configs/smdkc100_defconfig
@@ -1,4 +1,5 @@
 CONFIG_ARM=y
+CONFIG_FIT=y
 CONFIG_ARCH_CPU_INIT=y
 CONFIG_ARCH_S5PC1XX=y
 CONFIG_SYS_TEXT_BASE=0x20000000
@@ -9,7 +10,8 @@ CONFIG_IDENT_STRING=" for SMDKC100"
 CONFIG_DEFAULT_DEVICE_TREE="s5pc1xx-smdkc100"
 CONFIG_BOOTDELAY=3
 CONFIG_USE_BOOTARGS=y
-CONFIG_BOOTARGS="root=/dev/mtdblock5 ubi.mtd=4 rootfstype=cramfs console=ttySAC0,115200n8 mem=128M  mtdparts=s3c-onenand:256k(bootloader),128k@0x40000(params),3m@0x60000(kernel),16m@0x360000(test),-(UBI)"
+CONFIG_BOOTARGS="root=/dev/ram0 rw console=ttySAC0,115200n8 init=/linuxrc"
+CONFIG_BOOTCOMMAND="bootm 0x23000000 0x23500000 0x33000000"
 CONFIG_HUSH_PARSER=y
 # CONFIG_AUTO_COMPLETE is not set
 CONFIG_SYS_PROMPT="SMDKC100 # "
-- 
2.30.0

