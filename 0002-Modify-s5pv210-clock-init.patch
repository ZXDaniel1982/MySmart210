From 3e5456af9f9797ced29cc28bbf33610c790f7781 Mon Sep 17 00:00:00 2001
From: dzhang <daniel.zhang@aviatnet.com>
Date: Tue, 12 Jan 2021 14:17:22 +1300
Subject: [PATCH] Modify s5pv210 clock init

---
 arch/arm/mach-s5pc1xx/include/mach/cpu.h | 24 +++++++++++--------
 board/samsung/smdkc100/lowlevel_init.S   | 41 ++++++++++++++++----------------
 2 files changed, 34 insertions(+), 31 deletions(-)

diff --git a/arch/arm/mach-s5pc1xx/include/mach/cpu.h b/arch/arm/mach-s5pc1xx/include/mach/cpu.h
index 78c905b..5eea437 100644
--- a/arch/arm/mach-s5pc1xx/include/mach/cpu.h
+++ b/arch/arm/mach-s5pc1xx/include/mach/cpu.h
@@ -14,17 +14,21 @@
 /* S5PC100 */
 #define S5PC100_PRO_ID		0xE0000000
 #define S5PC100_CLOCK_BASE	0xE0100000
-#define S5PC100_GPIO_BASE	0xE0300000
-#define S5PC100_VIC0_BASE	0xE4000000
-#define S5PC100_VIC1_BASE	0xE4100000
-#define S5PC100_VIC2_BASE	0xE4200000
+#define S5PC100_GPIO_BASE	0xE0200000
+#define S5PC100_VIC0_BASE	0xF2000000
+#define S5PC100_VIC1_BASE	0xF2100000
+#define S5PC100_VIC2_BASE	0xF2200000
+#define S5PC100_VIC3_BASE   0xF2300000
 #define S5PC100_DMC_BASE	0xE6000000
-#define S5PC100_SROMC_BASE	0xE7000000
-#define S5PC100_ONENAND_BASE	0xE7100000
-#define S5PC100_PWMTIMER_BASE	0xEA000000
-#define S5PC100_WATCHDOG_BASE	0xEA200000
-#define S5PC100_UART_BASE	0xEC000000
-#define S5PC100_MMC_BASE	0xED800000
+#define S5PC100_SROMC_BASE	0xE8000000
+#define S5PC100_ONENAND_BASE	0xB0600100
+#define S5PC100_PWMTIMER_BASE	0xE2500000
+#define S5PC100_WATCHDOG_BASE	0xE2700000
+#define S5PC100_UART_BASE	0xE2900000
+#define S5PC100_MMC_BASE	0xEB000000
+#define S5PC100_DMC0_BASE       0xF0000000
+#define S5PC100_DMC1_BASE       0xF1400000
+#define S5PC100_LCD_BASE        0xF8000000
 
 /* S5PC110 */
 #define S5PC110_PRO_ID		0xE0000000
diff --git a/board/samsung/smdkc100/lowlevel_init.S b/board/samsung/smdkc100/lowlevel_init.S
index 3fbe66e..fbfd9ab 100644
--- a/board/samsung/smdkc100/lowlevel_init.S
+++ b/board/samsung/smdkc100/lowlevel_init.S
@@ -54,6 +54,9 @@ lowlevel_init:
 	str	r5, [r0, #0xf00]			@INTADDRESS
 	str	r5, [r1, #0xf00]			@INTADDRESS
 	str	r5, [r2, #0xf00]			@INTADDRESS
+	
+	/* for CLOCK */
+	bl system_clock_init
 
 	/* for UART */
 	bl uart_asm_init
@@ -72,14 +75,6 @@ lowlevel_init:
 system_clock_init:
 	ldr	r8, =S5PC100_CLOCK_BASE		@ 0xE0100000
 
-	/* Set Clock divider */
-	ldr	r1, =0x00011110
-	str	r1, [r8, #0x304]
-	ldr	r1, =0x1
-	str	r1, [r8, #0x308]
-	ldr	r1, =0x00011301
-	str	r1, [r8, #0x300]
-
 	/* Set Lock Time */
 	ldr	r1, =0xe10			@ Locktime : 0xe10 = 3600
 	str	r1, [r8, #0x000]		@ APLL_LOCK
@@ -88,30 +83,34 @@ system_clock_init:
 	str	r1, [r8, #0x00C]		@ HPLL_LOCK
 
 	/* APLL_CON */
-	ldr	r1, =0x81bc0400		@ SDIV 0, PDIV 4, MDIV 444 (1332MHz)
+	ldr	r1, =0x807d0301		@ SDIV 0, PDIV 4, MDIV 444 (1332MHz)
 	str	r1, [r8, #0x100]
 	/* MPLL_CON */
-	ldr	r1, =0x80590201		@ SDIV 1, PDIV 2, MDIV 89 (267MHz)
-	str	r1, [r8, #0x104]
-	/* EPLL_CON */
-	ldr	r1, =0x80870303		@ SDIV 3, PDIV 3, MDIV 135 (67.5MHz)
+	ldr	r1, =0x829b0c01		@ SDIV 1, PDIV 2, MDIV 89 (267MHz)
 	str	r1, [r8, #0x108]
-	/* HPLL_CON */
-	ldr	r1, =0x80600603
-	str	r1, [r8, #0x10C]
+	/* EPLL_CON */
+	ldr	r1, =0x80300302		@ SDIV 3, PDIV 3, MDIV 135 (67.5MHz)
+	str	r1, [r8, #0x110]
+	/* VPLL_CON */
+	ldr	r1, =0x806c0603
+	str	r1, [r8, #0x120]
 
 	/* Set Source Clock */
 	ldr	r1, =0x1111			@ A, M, E, HPLL Muxing
 	str	r1, [r8, #0x200]		@ CLK_SRC0
+	
+	/* Set Clock divider */
+	ldr	r1, =0x14131440
+	str	r1, [r8, #0x300]
 
-	ldr	r1, =0x1000001			@ Uart Clock & CLK48M Muxing
-	str	r1, [r8, #0x204]		@ CLK_SRC1
+	#ldr	r1, =0x1000001			@ Uart Clock & CLK48M Muxing
+	#str	r1, [r8, #0x204]		@ CLK_SRC1
 
-	ldr	r1, =0x9000			@ ARMCLK/4
-	str	r1, [r8, #0x400]		@ CLK_OUT
+	#ldr	r1, =0x9000			@ ARMCLK/4
+	#str	r1, [r8, #0x500]		@ CLK_OUT
 
 	/* wait at least 200us to stablize all clock */
-	mov	r2, #0x10000
+	mov	r2, #0x100000
 1:	subs	r2, r2, #1
 	bne	1b
 
-- 
2.7.4

